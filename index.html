<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bayleen Music</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

<style>
/* CSS MANUAL GW, ANJAY! */
* {
    box-sizing: border-box;
}
body {
    margin: 0;
    font-family: system-ui, sans-serif;
    background: #0a0a0a; /* Dark background */
    color: white;
    min-height: 100vh;
    position: relative;
    padding-bottom: 152px; 
}

/* HEADER/TOP BAR (Tidak Diubah) */
.header {
    position: sticky;
    top: 0;
    height: 64px;
    background: #1a1a1a;
    padding: 0 16px; 
    display: flex;
    align-items: center;
    gap: 12px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    z-index: 10;
}
.header input {
    flex: 1;
    max-width: 400px;
    padding: 8px 16px;
    border-radius: 999px;
    border: none;
    background: #2a2a2a;
    color: white;
    transition: background-color 0.2s;
    margin-right: 12px; 
}
.header input:focus {
    outline: none;
    background: #3a3a3a;
}
.header i {
    font-size: 24px;
    color: white;
}

/* KONTEN UTAMA & LIST (Tidak Diubah) */
.track-list {
    padding: 16px;
    padding-bottom: 96px; 
}
.track-list h2 {
    font-size: 20px;
    font-weight: bold;
    margin-bottom: 16px;
}
.track-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.2s;
}
.track-item:hover {
    background-color: #1e1e1e;
}
.track-item .info-section {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-grow: 1;
    overflow: hidden; 
}
.track-item img {
    min-width: 48px; 
    height: 48px;
    border-radius: 4px;
    object-fit: cover;
}
.track-item .info {
    overflow: hidden;
}
.track-item .info span {
    display: block;
    white-space: nowrap; 
    overflow: hidden;
    text-overflow: ellipsis; 
    max-width: 100%;
}
.track-item .info .title {
    font-size: 14px;
    font-weight: 500;
}
.track-item .info .artist {
    font-size: 12px;
    color: #a0a0a0;
}
.track-item button {
    background: none;
    border: none;
    color: #a0a0a0;
    cursor: pointer;
    font-size: 16px;
    transition: color 0.2s;
}
.track-item button:hover {
    color: white;
}
.track-item .action-section {
    flex-shrink: 0;
}

/* MINI PLAYER CONTROLS WRAPPER (FIX Z-INDEX) */
.mini-player-wrapper {
    position: fixed;
    bottom: 56px; 
    width: 100%;
    z-index: 20; /* Jaga agar lebih tinggi dari konten utama */
    transition: transform 0.3s ease-in-out;
    transform: translateY(100%); 
    padding: 0 8px; 
}

/* MINI PLAYER LIQUID GLASS STYLE */
.mini-player {
    position: relative; 
    height: 80px; 
    padding: 8px 12px; 
    padding-top: 12px; /* Tambahan padding agar konten tidak tertutup progress bar */
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin: 0; 
    border-radius: 0;
    
    background-color: rgba(30, 41, 59, 0.5); 
    backdrop-filter: blur(10px); 
    -webkit-backdrop-filter: blur(10px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3), 
                0 0 0 1px rgba(255, 255, 255, 0.1); 
    z-index: -1; /* Pastikan ini punya konteks stacking yang jelas */
}

/* Bagian Kiri Mini Player (Cover + Info) */
.mini-player .info-area {
    display: flex;
    align-items: center;
    gap: 8px; 
    flex-grow: 1;
    max-width: 50%; 
    overflow: hidden;
}

.mini-player img {
    min-width: 56px;
    height: 56px;
    border-radius: 8px; 
    object-fit: cover;
    flex-shrink: 0;
}
.mini-player .info {
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
}
.mini-player .info .title {
    font-size: 14px;
    font-weight: 500;
    overflow: hidden;
    text-overflow: ellipsis;
}
.mini-player .info .artist {
    font-size: 12px;
    color: #a0a0a0;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Bagian Kanan Mini Player (Controls) */
.mini-player .controls-area {
    display: flex;
    align-items: center;
    gap: 12px; 
    flex-shrink: 0;
    margin-right: 4px; 
}

.mini-player button {
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    transition: color 0.2s;
    padding: 4px;
    font-size: 16px; 
}
.mini-player #mini-play-pause-btn {
    font-size: 24px;
}
.mini-player button i:hover {
    color: #1db954; 
}


/* PROGRESS BAR STYLING (FIX: Z-INDEX DITINGGIKAN) */
#progress-bar {
    position: absolute; 
    top: 0;
    left: 0;
    width: 100%;
    z-index: 1000000; /* PENTING: Ditinggikan agar selalu di atas elemen lain di dalam mini-player */
    -webkit-appearance: none;
    appearance: none;
    background: transparent;
    cursor: pointer;
    margin: 0;
    padding: 0;
    border-radius: 0; 
    overflow: hidden;
}
#progress-bar::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 0px; 
    height: 0px;
    background: white;
    border-radius: 50%;
    transition: width 0.1s, height 0.1s;
}
#progress-bar:hover::-webkit-slider-thumb {
    width: 8px;
    height: 8px;
}
#progress-bar::-webkit-slider-runnable-track {
    width: 100%;
    height: 8px;
    background: transparent; 
    border-radius: 0px;
}
#progress-bar {
    background: linear-gradient(to right, #89ceeb 0%, #89ceeb 0%, #50bebb 0%, #ffffff 100%);
    background-size: 0% 100%;
    background-repeat: no-repeat;
}


/* NAVBAR BAWAH (MENU) */
.navbar-bottom {
    position: fixed;
    bottom: 0;
    width: 100%;
    height: 56px;
    background: #1a1a1a;
    border-top: 1px solid #2a2a2a;
    display: flex;
    justify-content: space-around;
    align-items: center;
    z-index: 30;
}
.navbar-bottom a {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: 10px;
    color: #a0a0a0;
    text-decoration: none;
    transition: color 0.2s;
}
.navbar-bottom a i {
    font-size: 20px;
    margin-bottom: 2px;
}
.navbar-bottom a:first-child {
    color: white; /* Home aktif */
}

/* UTILITY CLASSES */
.text-favorite {
    color: #1DB954 !important;
}
.text-autoplay {
    color: #1DB954 !important;
}
.text-repeat {
    color: #1DB954 !important;
}
.hidden {
    display: none !important;
}
audio {
    display: none;
}
</style>
</head>
<body>

<audio id="audio"></audio>

<div class="header">
  <i class="fas fa-arrow-left"></i>
  <input id="search" placeholder="Search Song....">
</div>

<div class="track-list" id="track-list-container">
    <h2 class="text-xl font-bold mb-4">Now Played</h2>
    
    <div id="loading-message" style="margin-top: 40px; text-align: center; color: #a0a0a0;">
        Search The Song Before Played.
    </div>

    <h2 style="margin-top: 32px; padding-top: 16px; border-top: 1px solid #2a2a2a;">Favorite Music ❤️</h2>
    <div id="favorites-list">
        <p style="color: #606060;" id="empty-favorites">Your Favorite Music, Not Found :(</p>
    </div>

</div>

<div class="mini-player-wrapper" id="mini-player-wrapper">
    <div id="mini-player" class="mini-player">
        <input type="range" id="progress-bar" min="0" max="100" value="0">
        
        <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
            <div class="info-area">
                <img id="mini-cover" src="https://via.placeholder.com/60/1db954/FFFFFF?text=R">
                <div class="info">
                    <span id="mini-title" class="title">Now Song Played</span>
                    <span id="mini-artist" class="artist">Artist</span>
                </div>
            </div>
            
            <div class="controls-area">
                <button id="volume-btn" onclick="toggleMute()" title="Toggle Mute">
                    <i id="volume-icon" class="fas fa-volume-up"></i> 
                </button>
                
                <button id="autoplay-btn" onclick="toggleAutoplay()" title="Shuffle/Autoplay">
                    <i class="fas fa-random"></i> 
                </button>
                
                 <button id="repeat-btn" onclick="toggleRepeat()" title="Repeat Song">
                    <i class="fas fa-redo-alt"></i> 
                </button>
                
                <button id="mini-favorite-btn" onclick="toggleFavorite()" title="Add to Favorites">
                    <i class="fas fa-heart"></i>
                </button>
                
                <button id="mini-play-pause-btn" onclick="togglePlay()">
                    <i id="mini-play-icon" class="fas fa-play"></i> 
                </button>

                <button onclick="alert('Next belum dibuat, Bro!')">
                    <i class="fas fa-step-forward"></i>
                </button>
            </div>
        </div>
        
    </div>
</div>

<div class="navbar-bottom">
    <a href="#">
        <i class="fas fa-home"></i> Home
    </a>
    <a href="#">
        <i class="fas fa-search"></i> Cari
    </a>
    <a href="#">
        <i class="fas fa-list-ul"></i> Koleksi Ka...
    </a>
    <a href="#">
        <i class="fas fa-plus"></i> Buat
    </a>
</div>


<script>
// VARIBEL GLOBAL
const audio = document.getElementById('audio');
const search = document.getElementById('search');
const listContainer = document.getElementById('track-list-container');
const miniPlayerWrapper = document.getElementById('mini-player-wrapper');
const miniCover = document.getElementById('mini-cover');
const miniTitle = document.getElementById('mini-title');
const miniArtist = document.getElementById('mini-artist');
const miniPlayIcon = document.getElementById('mini-play-icon');
const miniFavoriteBtn = document.getElementById('mini-favorite-btn');
const favoritesListContainer = document.getElementById('favorites-list');
const emptyFavoritesMsg = document.getElementById('empty-favorites');
const loadingMessage = document.getElementById('loading-message');
const progressBar = document.getElementById('progress-bar'); 
const autoplayBtn = document.getElementById('autoplay-btn'); 
const repeatBtn = document.getElementById('repeat-btn'); 
const volumeIcon = document.getElementById('volume-icon'); 

let currentSong = null; 
const FAVORITES_KEY = 'rayleen_favorites';
let isAutoplayEnabled = false; 
let isRepeatEnabled = false; 
let isMuted = false; 

// --- FUNGSI AUTOPLAY (Shuffle Logic) ---
function toggleAutoplay() {
    isAutoplayEnabled = !isAutoplayEnabled;
    if (isAutoplayEnabled) {
        autoplayBtn.classList.add('text-autoplay');
        alert('Shuffle/Autoplay Is On');
    } else {
        autoplayBtn.classList.remove('text-autoplay');
        alert('Shuffle/Autoplay Is OFF');
    }
}

// --- FUNGSI REPEAT ---
function toggleRepeat() {
    isRepeatEnabled = !isRepeatEnabled;
    audio.loop = isRepeatEnabled; 
    
    if (isRepeatEnabled) {
        repeatBtn.classList.add('text-repeat');
        alert('Repeat Mode ON.');
    } else {
        repeatBtn.classList.remove('text-repeat');
        alert('Repeat Mode OFF.');
    }
}

// --- FUNGSI VOLUME/MUTE ---
function toggleMute() {
    isMuted = !isMuted;
    audio.muted = isMuted; 
    
    if (isMuted) {
        volumeIcon.className = 'fas fa-volume-mute';
        alert('Volume MUTE.');
    } else {
        volumeIcon.className = 'fas fa-volume-up';
    }
}

// --- FUNGSI PROGRESS BAR ---
function updateProgress() {
    if (audio.duration) {
        const progressPercent = (audio.currentTime / audio.duration) * 100;
        progressBar.value = progressPercent;
        progressBar.style.backgroundSize = `${progressPercent}% 100%`;
    }
}

function seekAudio() {
    const seekTime = (progressBar.value / 100) * audio.duration;
    audio.currentTime = seekTime;
}
progressBar.addEventListener('input', seekAudio);


// --- FUNGSI FAVORIT ---
function getFavorites() {
    try {
        const favorites = localStorage.getItem(FAVORITES_KEY);
        return favorites ? JSON.parse(favorites) : {};
    } catch (e) {
        console.error("Failed Wrute localStorage, Bro:", e);
        return {};
    }
}

function saveFavorites(favorites) {
    try {
        localStorage.setItem(FAVORITES_KEY, JSON.stringify(favorites));
    } catch (e) {
        console.error("Failed Write localStorage, :", e);
    }
}

function toggleFavorite() {
    if (!currentSong) return;

    let favorites = getFavorites();
    const songId = currentSong.id;

    if (favorites[songId]) {
        delete favorites[songId];
        miniFavoriteBtn.classList.remove('text-favorite');
    } else {
        favorites[songId] = currentSong;
        miniFavoriteBtn.classList.add('text-favorite');
    }
    
    saveFavorites(favorites);
    renderFavorites();
}

function checkFavoriteStatus(songId) {
    const favorites = getFavorites();
    return !!favorites[songId];
}

// --- RENDER FAVORIT & TRACK LIST ---
function renderFavorites() {
    const favorites = getFavorites();
    const songs = Object.values(favorites);
    favoritesListContainer.innerHTML = '';

    if (songs.length === 0) {
        favoritesListContainer.appendChild(emptyFavoritesMsg);
        emptyFavoritesMsg.classList.remove('hidden');
        return;
    }
    emptyFavoritesMsg.classList.add('hidden');

    songs.forEach(song => {
        const item = createTrackElement(song, true);
        favoritesListContainer.appendChild(item);
    });
}

function createTrackElement(song, isFavoriteList = false) {
    const div = document.createElement('div');
    div.className = 'track-item';
    
    div.dataset.id = song.id;
    div.dataset.title = song.title;
    div.dataset.artist = song.artist;
    div.dataset.url = song.url;
    div.dataset.cover = song.cover;
    
    // UI Item
    div.innerHTML = `
        <div style="background-color: rgb(188,188,255,0.3); backdrop-filter: blur(8px); border-radius: 8px; padding: 8px; flex-grow: 1;" class="info-section" onclick="playSongFromList('${song.id}')">
            <img src="${song.cover}">
            <div class="info">
                <span class="title">${song.title}</span>
                <span class="artist">${song.artist}</span>
            </div>
        </div>
        <div class="action-section">
            ${isFavoriteList ? 
                `<button style="color: #ff4d4d;" onclick="removeFavorite('${song.id}')">
                    <i class="fas fa-trash-alt"></i>
                </button>` 
                : 
                `<button onclick="alert('Option Not Makes :(')">
                    <i class="fas fa-ellipsis-v"></i>
                </button>`
            }
        </div>
    `;

    return div;
}

function removeFavorite(songId) {
    let favorites = getFavorites();
    delete favorites[songId];
    saveFavorites(favorites);
    if (currentSong && currentSong.id === songId) {
        miniFavoriteBtn.classList.remove('text-favorite');
    }
    renderFavorites();
}

// --- FUNGSI PLAYER ---
function updateMiniPlayerUI(song) {
    miniCover.src = song.cover;
    miniTitle.innerText = song.title;
    miniArtist.innerText = song.artist;
    miniPlayerWrapper.style.transform = 'translateY(0)'; 
    
    // Reset progress bar
    progressBar.value = 0;
    progressBar.style.backgroundSize = '0% 100%'; 

    if (checkFavoriteStatus(song.id)) {
        miniFavoriteBtn.classList.add('text-favorite');
    } else {
        miniFavoriteBtn.classList.remove('text-favorite');
    }
}

function playSongFromList(songId) {
    const element = document.querySelector(`[data-id="${songId}"]`);
    if (!element) return;

    currentSong = {
        id: element.dataset.id,
        title: element.dataset.title,
        artist: element.dataset.artist,
        url: element.dataset.url,
        cover: element.dataset.cover,
    };
    
    audio.src = currentSong.url;
    audio.play();
    updateMiniPlayerUI(currentSong);
}

function togglePlay() {
    if (!currentSong) return;

    if (audio.paused) {
        audio.play();
        miniPlayIcon.className = 'fas fa-pause';
    } else {
        audio.pause();
        miniPlayIcon.className = 'fas fa-play';
    }
}

// --- EVENT HANDLER AUDIO ---
audio.addEventListener('play', () => {
    miniPlayIcon.className = 'fas fa-pause';
});

audio.addEventListener('pause', () => {
    miniPlayIcon.className = 'fas fa-play';
});

audio.addEventListener('ended', () => {
    // Logic Autoplay (Shuffle)
    if (isAutoplayEnabled) {
        if (currentSong) {
            audio.src = currentSong.url;
            audio.play();
            alert(`Autoplay Mode Is On! ${currentSong.title}`);
        }
    } else {
        miniPlayIcon.className = 'fas fa-play';
        progressBar.value = 0;
        progressBar.style.backgroundSize = '0% 100%';
    }
});

// Update progress bar saat lagu berjalan
audio.addEventListener('timeupdate', updateProgress);

// --- EVENT HANDLER SEARCH ---
search.addEventListener('keydown', async (e) => {
    if (e.key === 'Enter') {
        const q = search.value;
        loadingMessage.innerText = 'Searching Song...';
        
        // MUSIC API
        const music = await fetch(`https://api-faa.my.id/faa/soundcloud-play?query=${q}`).then(r => r.json()).catch(() => null);

        if (!music || !music.status) {
            loadingMessage.innerText = 'Not Found :(';
            return;
        }
        
        // Buat objek lagu dari hasil API
        const newSong = {
            id: 'song_' + Date.now(), 
            title: music.info.title,
            artist: music.info.artist,
            url: music.download.url,
            cover: music.info.thumbnail,
        };

        // Hapus pesan loading
        if (loadingMessage) loadingMessage.remove(); 

        const trackItem = createTrackElement(newSong, false);
        
        const h2Fav = listContainer.querySelector('h2:nth-of-type(2)');
        listContainer.insertBefore(trackItem, h2Fav); 

        // Otomatis play lagu baru
        playSongFromList(newSong.id);
    }
});

// --- INISIALISASI ---
document.addEventListener('DOMContentLoaded', () => {
    renderFavorites(); 
    
    // Set status awal ikon
    if (isAutoplayEnabled) autoplayBtn.classList.add('text-autoplay');
    if (isRepeatEnabled) repeatBtn.classList.add('text-repeat');
    
    miniPlayerWrapper.style.transform = 'translateY(100%)'; 
});
</script>

</body>
</html>
